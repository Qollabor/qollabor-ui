<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">

<link rel="import" href="/bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">
<link rel="import" href="/bower_components/paper-menu/paper-menu.html">
<link rel="import" href="/bower_components/paper-toolbar/paper-toolbar.html">

<link rel="import" href="../elements/cafienne-task/cafienne-task.html">
<link rel="import" href="../elements/cafienne-tasklist/cafienne-tasklist.html">
<link rel="import" href="../elements/cafienne-case/cafienne-case.html">
<link rel="import" href="../elements/cafienne-caselist/cafienne-caselist.html">
<link rel="import" href="../elements/cafienne-definitions/cafienne-definitions.html">
<link rel="import" href="../elements/cafienne-definition-view/cafienne-definition-view.html">

<link rel="import" href="/styles/shared-styles.html">

<dom-module id="cafienne-app">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      .content {
        margin-left: 16px;
        padding: 5px;
        height: 100vh;
      }

      .wrapper {
        height: 100%;
      }

      .nav {
        @apply(--layout-vertical);
      }

      .spacer {
        @apply(--layout-flex);
      }

      paper-toolbar {
        --paper-toolbar-height: 56px;
      }

      paper-menu iron-icon {
        margin-right: 33px;
        opacity: 0.54;
      }

      paper-menu.topmenu {
        background-color: #fafafa;
      }

      .paper-menu > .iron-selected {
        color: var(--accent-color);
      }

      paper-menu a {
        text-decoration: none;
        color: var(--menu-link-color);
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-size: 14px;
        font-weight: 400;
        line-height: 24px;
        min-height: 48px;
        padding: 0 16px;
      }

    </style>

    <div class="wrapper">
    <paper-drawer-panel id="paperDrawerPanel" responsive-width="1280px">

      <paper-header-panel class="nav" drawer>
        <!-- Nav Content -->
        <paper-toolbar id="sideLeft">
          <div class="title">[[appName]]</div>
        </paper-toolbar>
          <div>
            <div>
              <paper-menu class="list" attr-for-selected="menu-route" selected="[[section]]">
                <a menu-route="tasks" href="/tasks" on-tap="_listTap">
                  <iron-icon icon="inbox"></iron-icon>
                  <span>Tasks</span>
                </a>
                <a menu-route="cases" href="/cases" on-tap="_listTap">
                  <iron-icon icon="folder-open"></iron-icon>
                  <span>Cases</span>
                </a>
                <a menu-route="definitions" href="/definitions" on-tap="_listTap">
                  <iron-icon icon="folder"></iron-icon>
                  <span>Definitions</span>
                </a>
              </paper-menu>
            </div>
          </div>
      </paper-header-panel>

      <paper-header-panel class="main" main>

        <!-- Main Toolbar -->
        <paper-toolbar>
          <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
          <div class="spacer"></div>
          <paper-icon-button id="logout" icon="power-settings-new" title="logout"></paper-icon-button>
        </paper-toolbar>

        <!-- Main Content -->
        <div class="content">
          <iron-pages selected="{{section}}" attr-for-selected="data-route">
            <section data-route="tasks">
              <cafienne-tasklist></cafienne-tasklist>
            </section>
            <section data-route="taskdetails">
              <cafienne-task task-id="{{selectedTaskId}}"></cafienne-task>
            </section>
            <section data-route="cases">
              <cafienne-caselist></cafienne-caselist>
            </section>
            <section data-route="casedetails">
              <cafienne-case case-id="{{selectedCaseId}}"></cafienne-case>
            </section>
            <section data-route="definitions">
              <cafienne-definitions></cafienne-definitions>
            </section>
            <section data-route="definitiondetails">
              <cafienne-definition-view definition-name="{{selectedDefinitionName}}"></cafienne-definition-view>
            </section>

          </iron-pages>
        </div>

      </paper-header-panel>

    </paper-drawer-panel>
  </div>

  <div id="toasts">
    <paper-toast id="notification" text="notification"></paper-toast>
    <paper-toast id="success" text="success"></paper-toast>
    <paper-toast id="warn" text="warn"></paper-toast>
    <paper-toast id="error" text="error"></paper-toast>
  </div>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cafienne-app',

      listeners: {
        'logout.tap': '_logout'
      },

      properties: {
        appName: {
          type: String,
          value: 'CAFIENNE'
        },
        section: {
          type: String,
          reflectToAttribute: true
        },
        selectedTaskId: {
          type: String,
          notify: true,
          value: ''
        },
        selectedCaseId: {
          type: String,
          notify: true,
          value: ''
        },
        selectedDefinitionName: {
          type: String,
          notify: true,
          value: ''
        },

      },

      _computeListWidth: function(isMobile) {
        // when in mobile screen size, make the list be 100% width to cover the whole screen
        return isMobile ? '100%' : '33%';
      },
      _listTap: function() {
        this.$.paperDrawerPanel.closeDrawer();
      },
      _logout: function() {
        sessionStorage.clear();
        page.redirect('/login');
      },

      showToast: function(type, message, duration, log) {
        if (log) {
          console.log(message);
        }
        var selector = '#toasts #' + type;
        var toast = document.querySelector(selector);

        toast.text = message;
        toast.duration = duration;
        toast.show();
      }
    });
  })();
  </script>
</dom-module>
