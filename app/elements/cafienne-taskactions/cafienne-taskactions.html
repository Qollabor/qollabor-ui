<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">

<dom-module id="cafienne-taskactions">
  <template>
    <!-- ajax calls -->
    <iron-ajax id="makePlanItemTransition"
               method="POST"
               content-type="application/json"
               handle-as="json"
               last-response="{{transitionresult}}"
               on-error="_handleTransitionResponse"
               on-response="_handleTransitionResponse"></iron-ajax>

    <style>
      :host {
        display: block;
      }


      paper-icon-button.blue {
        color: var(--paper-light-blue-500);
        --paper-button-flat-focus-color: var(--paper-light-blue-50);
      }
      paper-icon-button.blue:hover {
        background: var(--paper-light-blue-50);
      }
      paper-icon-button.red {
        color: var(--paper-red-500);
        --paper-button-flat-focus-color: var(--paper-red-50);
      }
      paper-icon-button.red:hover {
        background: var(--paper-red-50);
      }
      paper-icon-button.green {
        color: var(--paper-green-500);
        --paper-button-flat-focus-color: var(--paper-green-50);
      }
      paper-icon-button.green:hover {
        background: var(--paper-green-50);
      }
      paper-icon-button.orange {
        color: var(--paper-orange-500);
        --paper-button-flat-focus-color: var(--paper-orange-50);
      }
      paper-icon-button.orange:hover {
        background: var(--paper-orange-50);
      }
    </style>
    <div id="taskactions">
      <paper-icon-button id="complete" on-tap="_handleTapAction" class="green" icon="check"></paper-icon-button>
      <paper-icon-button id="terminate" on-tap="_handleTapAction" class="red" icon="clear"></paper-icon-button>
      <paper-icon-button id="suspend" on-tap="_handleTapAction" class="orange" icon="av:pause"></paper-icon-button>
      <paper-icon-button id="resume" on-tap="_handleTapAction" class="blue" icon="av:play-arrow"></paper-icon-button>
      <paper-tooltip for="complete" offset="-5">complete</paper-tooltip>
      <paper-tooltip for="terminate" offset="-5">terminate</paper-tooltip>
      <paper-tooltip for="suspend" offset="-5">suspend</paper-tooltip>
      <paper-tooltip for="resume" offset="-5">resume</paper-tooltip>
    </div>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cafienne-taskactions',

      properties: {
        taskState: {
          type: String
        },
        taskId: {
          type: String,
          reflectToAttribute: true
        },
        caseInstanceId: {
          type: String,
          reflectToAttribute: true
        }
      },

      _handleTapAction: function(e) {
        var transition = e.target.parentElement.id;
        console.log('Transition: ' + transition + ' for ' + this.taskId +  ' case: ' + this.caseInstanceId);
        this.$.makePlanItemTransition.headers = {'X-AUTH-CAFIENNE': sessionStorage.getItem('X-AUTH-CAFIENNE')};
        this.$.makePlanItemTransition.url = ['http://localhost:18082/cases', this.caseInstanceId, 'planitems', this.taskId, transition].join('/');
        this.$.makePlanItemTransition.generateRequest();
      },

      _handleTransitionResponse: function(e) {
        switch (e.type) {
          case 'error':
            app.showToast('error', 'Transition failed', 3000, true);
            break;
          case 'response':
            app.showToast('success', 'Transition successful', 3000, true);
            break;
        }
      }
    });
  })();
  </script>
</dom-module>
