<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/bower_components/iron-list/iron-list.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">

<link rel="import" href="/bower_components/paper-styles/color.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-material/paper-material.html">
<link rel="import" href="/bower_components/paper-listbox/paper-listbox.html"/>

<link rel="import" href="../../styles/shared-styles.html">

<dom-module id="cafienne-definitions">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        height: 100vh;
      }

      #definitionslist {
        height: 100%;
      }

      paper-material {
        background-color: white;
        max-width: calc(97.33% - 32px);
      }

      iron-list {
        padding-top: 1px;
        padding-bottom: 0px;
        -webkit-flex: 1 1;
        flex: 1 1;
        --iron-list-items-container: {
          margin: auto;
        };
      }

      .definitionscontainer {
        @apply(--layout-horizontal);
        height: 100vh;
      }

      .definitioninfo {
        @apply(--layout-horizontal);
      }

      .definition {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        background-color: white;
        margin-bottom: 8px;
        cursor: pointer;
        height: 48px;
      }

      .definition:focus {
        outline: 0;
        border-left: solid 2px;
        border-left-color: var(--accent-color);
      }

      .definition:hover {
        outline: 0;
        border-left: solid 2px;
        border-left-color: var(--dark-primary-color);
      }

      .spacer {
        @apply(--layout-flex);
      }

      .buttons {
        @apply(--layout-horizontal);
        max-width: calc(97.33% - 32px);
      }

      paper-toolbar {
        background-color: var(--primary-color);
      }

      plan-item {
        padding: 10px;
        margin: 10px;
      }

      cafienne-definition-view {
        padding: 10px;
        margin: 10px;
      }

    </style>
    <iron-ajax id="getDefinitionsList"
               handle-as = "json"
               last-response = "{{definitionsdata}}"
               on-response = "handleResponse"></iron-ajax>

   <div class="buttons">
     <span class="spacer"></span>
     <paper-icon-button id="refresh" icon="refresh"></paper-icon-button>
     <paper-icon-button id="previous" icon="chevron-left"></paper-icon-button>
     <paper-icon-button id="next" icon="chevron-right"></paper-icon-button>
   </div>

    <div class="definitionscontainer">
      <iron-list id="definitionslist" items={{definitionsdata.models}} as="definition">
        <template>
          <div>
          <paper-material class="definition" elevation="1">
            <div class="definitioninfo" id="definition.definitions" on-tap="_selectDefinitionDetails">
              <span class="pad">[[definition.definitions]]</span>
            </div>
            <span class="spacer"></span>
              <!--cafienne-taskactions class="pad" task-state="Active" task-id="{{task.id}}" case-instance-id="{{task.caseId}}"></cafienne-taskactions-->
          </paper-material>
          </div>
        </template>
      </iron-list>
    </div>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'cafienne-definitions',

      properties: {
        selectedDefinition: {
          type: Object,
          notify: true
        },
        definitionsdata: {
          type: Object,
          notify: true,
          value: {}
        }
      },

      listeners: {
        'refresh.tap': '_buttonPressed',
        'previous.tap': '_buttonPressed',
        'next.tap': '_buttonPressed'
      },

      ready: function() {

      },

      handleResponse: function() {
        //console.log(this.$.getDefinitionsList.lastResponse);
        var definition = this.definitionsdata.models[0];
        this.selectedDefinition = definition;
      },

      _selectDefinitionDetails: function(e) {
        app.section = 'definitiondetails';
        app.selectedDefinitionName = e.model.definition.definitions;
        page.redirect('/definitions/' + e.model.definition.definitions);
      },

      _getDefinitionsList: function() {
        this.$.getDefinitionsList.headers = {'X-AUTH-CAFIENNE' : sessionStorage.getItem('X-AUTH-CAFIENNE')};
        this.$.getDefinitionsList.url = 'http://localhost:18082/repository/list';
        this.$.getDefinitionsList.generateRequest();
      },

      _buttonPressed: function(e) {
        switch (e.target.parentElement.id) {
          case 'refresh':
            this._getDefinitionsList();
            break;
          case 'previous':
            break;
          case 'next':
            break;
          default:
            console.log('Oops, something went wrong');
        }
      }

    });
  })();
  </script>
</dom-module>
